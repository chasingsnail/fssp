/*!
 * =====================================================
 * AWS地址簿运行时库文件
 * v1.0 (http://www.actionsoft.com.cn)
 * 发布后文件名：aws.address.js
 * =====================================================
 */
(function(a){a.fn.address=function(h){var r={callback:null,beforeCancel:null,filter:{addressType:"user",isAdvMode:true,isAddTeam:false,addressSetting:{title:人员,rootDetpId:"",isDisplayMap:true,isMapFormat:true,mapSuffix:"($dept $role)",isDisplayOtherMap:false,layerFrom:"",layerTo:"",range:"department|role|team",delimiter:" ",choiceType:"single",leafType:"user",filterClass:""},sourceField:"",targetField:"",deptSourceField:"",deptTargetField:""},valueType:0,separator:" ",inDialog:false,dialogId:"",isGrid:false,gridId:"",gridRowIndx:0,isClearData:true,isLiveSearch:true,allowAnyValue:false,maxRowNumber:0,clearCallback:null};var b=r;if(h){b=a.extend(true,r,h)}if(h==undefined||h.filter==undefined){var w={separator:" ",filter:{addressType:"user",isAdvMode:false},allowAnyValue:false,isLiveSearch:true};b=a.extend(w,h)}else{if(b.filter.sourceField==""){if(b.filter.deptSourceField){b.filter.sourceField=b.filter.deptSourceField;b.filter.targetField=b.filter.deptTargetField}else{if(h.valueType){if(h.valueType==0){b.filter.sourceField="USERNAMEALIAS"}else{if(h.valueType==1){b.filter.sourceField="UID"}else{if(h.valueType==2){b.filter.sourceField="USERNAME"}}}}}}if(h.separator){b.filter.addressSetting.delimiter=h.separator}else{b.separator=b.filter.addressSetting.delimiter}}if(b.filter&&b.filter.addressSetting&&b.filter.addressSetting.rootDeptId!=undefined){b.filter.addressSetting.rootDetpId=b.filter.addressSetting.rootDeptId}var u=a(this);if(!b.isAddTeam){if(a("#addTeamDlg")){a("#addTeamDlg").hide()}}if(b.filter.addressType=="dept"){b.address=getTargetValue(a(this).attr("name"),b);b.value=u.val()}else{if(b.filter.addressType=="user"&&b.filter.isAdvMode){b.value=u.val()}}var s;if(b.filter.targetField){s=b.filter.targetField.replace(/,/g,"|")}else{if(b.filter.deptTargetField){s=b.filter.deptTargetField.replace(/,/g,"|")}}b.isClearData=u.hasClass("disable")?false:b.isClearData;b.boItemName=u.attr("id");var l="";if(a("#sid").length>0){l=a("#sid").val()}else{if(a("input[name=sid]").length>0){l=a("input[name=sid]").val()}}var j="_bpm.portal";if(a("#appId").length>0){j=a("#appId").val()}if(l==""||l==undefined){return}var C=地址簿;var y=false;try{y=a("#isMobile").val()=="true"?true:false}catch(E){}var D=a.escapeSelector(u.attr("id"));if(a("#awsui-address-"+D).length==1){return}if(u.prop("readonly")){b.isLiveSearch=false}if(D.indexOf("Address_")>-1){b.gridId=h.gridId;b.gridRowIndx=h.gridRowIndx;b.isGrid=true}var C=人员;if(b.filter&&b.filter.addressSetting&&b.filter.addressSetting.leafType=="dept"){C=部门}else{if(b.filter&&b.filter.addressSetting&&b.filter.addressSetting.leafType=="team"){C=群组}}var k=function(e){a("#"+a.escapeSelector(e)).trigger("blur.casecade_"+e)};window.deleteItem=function(O){var e=a(O).parent();var p=e.parent();if(p.find(".awsui-address-btn").hasClass("disable")){return}var P=a.escapeSelector(p.find("input").attr("id"));var M=e.attr("value")||e.attr("id");var N=a("#"+P).val();var R=p.attr("delimiter")||" ";var Q=N.split(R);for(var t=0;t<Q.length;t++){if(Q[t]==M){Q.splice(t,1);break}}p.find("input").val(Q.join(R));e.remove();if(b.clearCallback&&p.find(".awsui-item").length==0){b.clearCallback()}H();k(P)};var B="";var v=u.attr("title")?("title='"+u.attr("title")+"'"):"";var z=u.outerWidth();var d=a("<div id='awsui-address-"+u.attr("id")+"' "+v+" "+B+" delimiter='"+b.separator+"' style='position:relative' class='awsui-address'></div>");var J=a("<div class='awsui-iconfont awsui-address-btn' style='position:relative;right:0px;z-index:4'>&#59008;</div>");var L=a("<div class='awsui-iconfont awsui-address-del' style='position:absolute;right:20px;z-index:5'>&#58927;</div>");var x=u.attr("placeholder")?u.attr("placeholder"):"";var o=a("<div id='awsui-placeholder-"+u.attr("id")+"' style='overflow:hidden;color: #CCC;font-size: 13px;display:none;height:24px;line-height:25px;'>"+x+"</div>");if(!y){L.attr("title",全部删除)}d.append(J);d.append(L);d.append(o);var H=function(){if(a("#"+D).val()==""){a("#awsui-placeholder-"+D).show()}else{a("#awsui-placeholder-"+D).hide()}};if(a("#"+D).val()==""){o.show()}if(b.maxRowNumber>0){d.addClass("fixed-h").css("max-height",b.maxRowNumber*24+"px")}if(b.isGrid){d.addClass("grid");J.addClass("grid")}u.before(d);d.prepend(u);if(y){z=d.width()}d.outerWidth(z);o.outerWidth(z-38);if(d.parent().hasClass("required")&&a.browser.isFirefox){d.parent().css("display","block")}u.hide();var q=function(){H();var e=a("#"+D).val()||"";if(e==""){d.find(".awsui-item").remove();return}var p={};if(b.isGrid){p=a("#"+b.gridId).awsGrid("getRowData",b.gridRowIndx)}else{if(window.AWSForm){p=AWSForm.getFormData()}}awsui.ajax.request({type:"POST",url:"./jd",async:false,data:{sid:l,cmd:"CLIENT_AWSUI_ADDRESS_VALUE",address:awsui.encode(b),addressDomId:D,value:e,formData:awsui.encode(p)},ok:function(t){d.find(".awsui-item").remove();d.append(a(t.data.data));d.find(".awsui-item-del").removeAttr("onclick").off("click").on("click",function(){deleteItem(a(this));return false});d.find(".awsui-item").off("click").on("click",function(){event.stopPropagation()});if(y=="true"){if(d.find(".awsui-item").length>0){L.show()}d.find(".awsui-item").each(function(){var M=z-35;if(a(this).find(".awsui-item-icon").length>0){M=z-52}a(this).find(".awsui-item-t").css("max-width",M+"px")})}},err:function(t){}})};q();var i=u.parents("form");if(i.length>0){i.on("reset",function(){setTimeout(function(){q()},10)})}u.off("change.render").on("change.render",function(){q()});if(u.prop("disabled")){J.addClass("disable");return}if(!y){d.on("mouseover",function(){if(d.find(".awsui-item").length>0){if(!u.prop("disabled")){L.show()}}});d.on("mouseleave",function(){L.hide()})}L.off("click").on("click",function(){L.hide();var N=a(this).parent();N.find("input").val("");q();if(b.clearCallback){b.clearCallback()}if(s){var t=s.split("|");if(b.isGrid){N.find(".awsui-item").remove();var e=a("#"+b.gridId).awsGrid("getRowData",b.gridRowIndx);for(var p=0;p<t.length;p++){var M=t[p];e[M]="";if(e.hasOwnProperty(M+"_DISPLAYVALUE")){e[M+"_DISPLAYVALUE"]=""}a("#"+b.gridId).awsGrid("setEditData",e)}a("#"+b.gridId).awsGrid("refresh")}else{for(var p=0;p<t.length;p++){var M=t[p];window.ui?ui(M,""):a("#"+M).val("");a("#"+M).trigger("change")}}}H();k(D);return false});if(y){J.off("click").on("click",function(){var O={};a.extend(true,O,b);try{var p=b.filter.addressSetting.rootDetpId;if(/^\$.*/g.test(p)){var M="";M=a("#"+p.replace("$","")).val();b.filter.addressSetting.rootDetpId=M}}catch(N){}var t="./w?sid="+l+"&cmd=CLIENT_UI_ADDRESSBOOK&appId"+j+"&address="+encodeURI(b);try{openMobileDialog("address",D,b.filter)}catch(N){}b=O})}else{var F=function(){var P=600;var p=450;if(b.inDialog==false){P=a(window).width()-50;p=a(window).height()-50}if(P>615){P=615}if(p>450){p=450}var M=FrmDialog;if(b.inDialog){M=parent.FrmDialog}var O={};if(b.isGrid){O=a("#"+b.gridId).awsGrid("getRowData",b.gridRowIndx)}else{if(window.AWSForm){O=AWSForm.getFormData()}}var R={};a.extend(true,R,b);try{var t=b.filter.addressSetting.rootDetpId;if(t.indexOf("$")==0){t=t.substring(1,t.length);t=O[t];R.filter.addressSetting.rootDetpId=t}if(b.inDialog&&window.name=="dialog_toolbar_action_page_frame"){parent.$("#dialog_toolbar_action .dlg-button button").attr("disabled","true")}}catch(N){}var Q=M.open({id:"address_dialog",title:C,width:P,height:p,url:"./w",data:{sid:l,cmd:"CLIENT_AWSUI_ADDRESSBOOK",appId:a("#appId").val(),address:awsui.encode(R),addressDomId:D,value:a("#"+D).val(),formData:awsui.encode(O)},buttons:[{text:确定,id:"address_dialog_button_confirm",cls:"blue",handler:function(){var U="";var V=Q.win();var T=V.getValue();var S=T.value;var e=T.showValue;var W=T.gridValue;d.find(".awsui-item").remove();d.append(a(e));d.find(".awsui-item-del").removeAttr("onclick").off("click").on("click",function(){deleteItem(a(this));return false});a.each(S,function(Y,Z){if(b.isGrid){if(Y.startsWith("Address_")){Y=Y.substring("Address_".length)}a("#Address_"+a.escapeSelector(Y)).val(Z);if(b.gridId){var X=a("#"+a.escapeSelector(b.gridId)).awsGrid("getRowData",b.gridRowIndx);X[Y]=Z;if("ADDRESS_"+Y==D&&X.hasOwnProperty(Y+"_DISPLAYVALUE")){X[Y+"_DISPLAYVALUE"]=W}a("#"+a.escapeSelector(b.gridId)).awsGrid("setEditData",X);a("#"+a.escapeSelector(b.gridId)).awsGrid("refreshRow",{rowIndx:b.gridRowIndx})}}else{if(window.ui&&typeof(window.ui)=="function"){window.ui(a.escapeSelector(Y),Z)}else{a("#"+a.escapeSelector(Y)).val(Z)}if(Y!=D){a("#"+a.escapeSelector(Y)).trigger("change")}k(D)}});if(window.onAddressSelectedEvent){window.onAddressSelectedEvent(D,S[D]||"",S)}if(b.callback!=null){b.callback()}H();Q.close("address_dialog")}},{text:取消,handler:function(){a.mask("close");try{if(b.inDialog&&window.name=="dialog_toolbar_action_page_frame"){parent.$("#dialog_toolbar_action .dlg-button button").removeAttr("disabled")}}catch(S){}Q.close("address_dialog")}}],onClose:function(S){try{if(b.inDialog&&window.name=="dialog_toolbar_action_page_frame"){parent.$("#dialog_toolbar_action .dlg-button button").removeAttr("disabled")}}catch(S){}}})};J.off("click").on("click",function(){if(!a(this).hasClass("disable")){F()}});if(u.prop("readonly")){d.on("click",function(){if(!J.hasClass("disable")){F();return false}})}var G=b.isLiveSearch!=undefined?b.isLiveSearch:true;if(G){var n=b.allowAnyValue!=undefined?b.allowAnyValue:false;var I=b.filter.sourceField?b.filter.sourceField:"USERNAMEALIAS";var A=b.filter.targetField?b.filter.targetField:D;var g=I.split(",");var m=A.split(",");var c="user";var K="multiple";if(b.filter.addressSetting){c=b.filter.addressSetting.leafType;K=b.filter.addressSetting.choiceType}var f=" ";if(b.filter.isAdvMode){f=b.separator||","}a("body").off("click.address").on("click.address",function(p){if(a(p.target).parents("#awsui-address-"+D).length==0||a(p.target).hasClass("awsui-iconfont")){a("#select2-livesearch-"+D).select2("destroy");a("#select2-livesearch-"+D).remove();H()}});d.off("click").on("click",function(Q){if(u.prop("disabled")){return}if(a("#"+D).val()!=""){placeholder=""}else{placeholder=u.attr("placeholder")?u.attr("placeholder"):""}var O=d.outerWidth()-2;var N=3;if(d.children(".awsui-item:last").length>0){N=d.children(".awsui-item:last").position().left+d.children(".awsui-item:last").outerWidth()+3}if(a.escapeSelector(a(Q.target).attr("id"))!="awsui-address-"+D&&a.escapeSelector(a(Q.target).attr("id"))!="awsui-placeholder-"+D){return}a("#awsui-placeholder-"+D).hide();if(a("#select2-livesearch-"+a.escapeSelector(D)).length==0){d.append("<select id='select2-livesearch-"+D+"'></select>");var P={width:O,multiple:true,placeholder:placeholder,tags:n,dropdownCss:{border:"1px solid #d2d2d2"},dropdownCssClass:"awsui-select2-dropdown-height",templateResult:M,ajax:{url:"./jd?sid="+l+"&cmd=CLIENT_AWSUI_ADDRESS_SEARCH",dataType:"json",delay:250,data:function(R){var e={type:c,config:awsui.encode(b),appId:j,sourceField:b.filter.sourceField,keyWord:R.term,page:R.page||1,limit:12};return e},processResults:function(e,R){R.page=R.page||1;return{results:e.data.list,pagination:{more:R.page<e.data.totalPageNum}}}},minimumInputLength:1};a("#select2-livesearch-"+D).select2(P);d.find(".select2-selection").css("border","0px solid red");d.find(".select2-container").css("position","absolute").css("bottom","0px").css("left","0px").css("height","26px").css("overflow","hidden");d.find(".select2-container").find("input.select2-search__field").css("position","absolute").css("top","1px").css("left",N).css("margin-top","3px");a("#select2-livesearch-"+D).focus();a("#select2-livesearch-"+D).on("select2:select",function(T){var S=a(this).select2("data");if(!S){return}for(var R=0;R<S.length;R++){if(d.find("[sourceId='"+a.escapeSelector(S[R].sourceId)+"']").length==0){t(S[R])}}a("#select2-livesearch-"+D).select2("destroy");a(this).remove();H()});function M(R){if(R.showtextsuffix){var e=a("<span >"+R.text+" <span style='color:#ccc;font-size:12px;'>"+R.showtextsuffix+"</span></span>");return e}return R.text}function t(R){var T=p(R);var S=T.value;var e=T.showValue;var U=T.gridValue;if(K=="single"){d.find(".awsui-item").remove();d.append(a(e));a.each(S,function(W,X){window.ui?ui(W,X):a("#"+W).val(X);a("#"+W).trigger("change");if(b.isGrid){a("#Address_"+W).val(X);var V=a("#"+b.gridId).awsGrid("getRowData",b.gridRowIndx);V[W]=X;if("ADDRESS_"+W==D&&V.hasOwnProperty(W+"_DISPLAYVALUE")){V[W+"_DISPLAYVALUE"]=U}a("#"+b.gridId).awsGrid("setEditData",V);a("#"+b.gridId).awsGrid("refreshRow",{rowIndx:b.gridRowIndx})}if(window.onAddressSelectedEvent){window.onAddressSelectedEvent(D,S[D]||"",S)}})}else{d.append(a(e));a.each(S,function(W,X){if(window.ui){if(ui(W)!=""){ui(W,ui(W)+f+X)}else{ui(W,X)}}else{if(a("#"+W).val()!=""){a("#"+W).val(a("#"+W).val()+f+X)}else{a("#"+W).val(X)}}a("#"+W).trigger("change");if(b.isGrid){a("#Address_"+W).val((a("#Address_"+W).val()==""?"":(a("#Address_"+W).val()+f))+X);var V=a("#"+b.gridId).awsGrid("getRowData",b.gridRowIndx);V[W]=V[W]==""?"":(V[W]+f)+X;V[W+"_DISPLAYVALUE"]=V[W+"_DISPLAYVALUE"]==""?"":(V[W+"_DISPLAYVALUE"]+f)+U;a("#"+b.gridId).awsGrid("setEditData",V);a("#"+b.gridId).awsGrid("refreshRow",{rowIndx:b.gridRowIndx})}if(window.onAddressSelectedEvent){window.onAddressSelectedEvent(D,S[D]||"",S)}})}if(b.callback!=null){b.callback()}}function p(T){if(!T.name){T.name=T.text}var e=T.name.replace("(兼)","");var W={};var af={};var V=[];var Z="";var U=[];for(var X=0;X<m.length;X++){var ab=g[X];var S=m[X];var Y=[];V=[];if(T[ab]){Y.push(T[ab]?T[ab]:"")}else{V.push(e)}if(S==D||D=="Address_"+S){var R=T[ab]||e;var e=e;var ag=e;var ae="";var ad="";if(c=="user"&&(ab=="UID"||ab=="USERNAMEALIAS")){ae="&#58939;";ad="user";var aa=T[ab]?T[ab]:T.text;if(ab=="USERNAMEALIAS"){var aa=aa.substring(0,aa.indexOf("<"))}ag="<span userid='"+aa+"' class='awsui-user-profile'>"+e+"</span>"}else{if(c=="dept"&&ab=="DEPTID"){ae="&#59318;";ad="dept"}else{if(c=="team"&&ab=="TEAMID"){ae="&#58945;";ad="team"}else{e=T[ab]?T[ab]:T.text;ag=T[ab]?T[ab]:T.text}}}Z+="<div class='awsui-item' sourceId='"+T.sourceId+"'  value='"+R+"' type='"+ad+"' >";var ac="";if(ae){ac="<div class='awsui-item-icon awsui-iconfont'>"+ae+"</div>"}Z+=ac;Z+="<div class='awsui-item-t'>"+ag+"</div>";Z+="<div class='awsui-item-del awsui-iconfont' onclick='deleteItem(this);return false;'>&#59134;</div></div>";U.push(e)}if(S==D){Y=a.merge(V,Y)}af[S]=Y.join(f)}W.value=af;W.showValue=Z;W.gridValue=U.join(f);return W}}return false})}}return};a.fn.acAddress=function(d){var f={title:"",width:700,resourceType:"platform.companyAdmin",defAssignmentTypes:"department",isClearData:false,clearField:"",okHandler:null};var e=f;if(d){e=a.extend(true,f,d)}var b="";if(a("#sid").length>0){b=a("#sid").val()}else{if(a("input[name=sid]").length>0){b=a("input[name=sid]").val()}}var c=a(this);c.buttonedit({iconCls:"icon-address",isClearData:e.isClearData,clearField:e.clearField,onClick:function(){var g=FrmDialog.open({title:e.title,width:700,fixed:false,model:false,height:380,id:"AC_FRAMEDLG",url:"./w",data:{sid:b,cmd:"CLIENT_UI_AC_ADDRESSBOOK_PAGE",resourceId:"",resourceType:e.resourceType,defAssignmentTypes:e.defAssignmentTypes},buttons:[{text:"确定",cls:"blue",handler:e.okHandler},{text:"关闭",handler:function(){g.close()}}]})}})}})(jQuery);function enableAllAddress(a){if(a&&document.parent){parent.$("button, .button, input[type='button']").removeAttr("disabled");parent.$("button, .button, input[type='button']").removeClass("disable")}else{$("button, .button, input[type='button']").removeAttr("disabled");$("button, .button, input[type='button']").removeClass("disable")}}function disableAllAddress(a){if(a&&document.parent){parent.$("button, .button, input[type='button']").attr("disabled","true");parent.$("button, .button, input[type='button']").addClass("disable")}else{$("button, .button, input[type='button']").attr("disabled","true");$("button, .button, input[type='button']").addClass("disable")}}function getValue(u,j,b,k){var g;if(u){g=u.win()}else{g=k}var n=false;try{n=parent.$("#isMobile").val()}catch(s){}var z;if(g.addressType=="user"){if(g.isSingle){z=g.getAdvancedSelectValue()}else{z=g.getAdvancedMultipartValue()}}else{if(g.addressType=="dept"){if(g.isSingle){z=g.getDeparmentValue()}else{z=g.getAdvancedMultipartValue()}}}z=awsui.decode(z);if(b.isGrid){$("#"+b.gridId).awsGrid("quitEditMode")}if(b.isGrid){var a=$("#"+b.gridId);var d=a.awsGrid("getRowData",b.gridRowIndx);var x=[];for(var o in z){d[o]=z[o];if(o+"_DISPLAYVALUE" in d){d[o+"_FINDTEXT"]=true}x.push(o)}if(parent.AWSGrid&&parent.AWSGrid.version){a.awsGrid("setEditData",{rowData:d,refresh:false,rowIndx:b.gridRowIndx})}else{a.awsGrid("setEditData",d)}for(var p in x){a.awsGrid("refreshCell",{rowIndx:b.gridRowIndx,dataIndx:x[p]})}}else{for(var o in z){try{var y=$("#"+o);var c=z[o].split(b.separator);if(y.length==1){y.focus();y.val(z[o]);if(y.hasClass("awsui-select")){y.customSelect(c[0]);y.val(c[0])}else{if(y.hasClass("awsui-combobox")){y.setComboboxVal(z[o])}else{if(y.attr("type")=="select2"){var m=z[o];var q=b.separator||",";if(m.indexOf(q)>0){m=m.split(q)}y.val(m).trigger("change")}}}if(y.is(":hidden")&&y.parent().find("label")){y.parent().find("label").html(z[o])}y.blur()}else{var f=$("input[name='"+o+"']:first").attr("type").toLowerCase();switch(f){case"radio":var l=$("input[name='"+o+"'][value='"+c[0]+"']");if(l.is(":visible")){l.check("option","checked",true)}else{var h=$("input[name='"+o+"']:first").prev().attr("src");var r=h.replace("icheck_radio_check","icheck_radio_uncheck");var t=h.replace("icheck_radio_uncheck","icheck_radio_check");$("input[name='"+o+"']").prev().attr("src",r);$("input[name='"+o+"']").prop("checked",false);l.prop("checked",true);l.prev().attr("src",t)}break;case"checkbox":if($("input[name='"+o+"'][value='"+c[0]+"']").is(":visible")){$("input[name='"+o+"']").check("option","checked",false);$.each(c,function(e,v){$("input[name='"+o+"'][value='"+v+"']").check("option","checked",true)})}else{var h=$("input[name='"+o+"']:first").prev().attr("src");var r=h.replace("icheck_checkbox_check","icheck_checkbox_uncheck");var t=h.replace("icheck_checkbox_uncheck","icheck_checkbox_check");$("input[name='"+o+"']").prev().attr("src",r);$("input[name='"+o+"']").prop("checked",false);$.each(c,function(e,w){var v=$("input[name='"+o+"'][value='"+w+"']");v.prop("checked",true);v.prev().attr("src",t)})}break;default:}}}catch(s){}}}if(n==true||n=="true"){}else{(j?parent.FrmDialog:FrmDialog).get("address_dialog").close()}return z}function getTargetValue(c,h){var n=$("#targetField_"+c).val();var d=$("#targetField_"+c).attr("delimiter");if(n==undefined||n==""){n="";if(h.filter.addressType=="user"){d=h.filter.addressSetting.delimiter;n=h.filter.targetField}else{if(h.filter.addressType=="dept"){n=h.filter.deptTargetField}}}var g=new Array();if(n!=""){var r=n.split(",");for(var p=0;p<r.length;p++){try{if(h.isGrid){var q=$("#"+h.gridId).awsGrid("getRowData",h.gridRowIndx);if(q[r[p]]==undefined){g.push("")}else{g.push(q[r[p]])}}else{g.push(document.getElementById(r[p]).value)}}catch(s){}}}if(d==undefined){return g}var b=getmailListOptions(g[0]);var a=b?b.split(d).length:0;var o=new Array(a);for(var m=0;m<a;m++){o[m]="";for(var p=0;p<g.length;p++){var t=getmailListOptions(g[p]);var l=t.split(d);var f=l[m]==""?null:l[m];o[m]+=f==null?"":(f.replace(/&nbsp;/g," ")+d)}if(o[m].endWith(d)){o[m]=o[m].substring(0,o[m].length-1)}}return o}function getmailListOptions(d){if(d){var a=d.match(/<[^>]+>/g);for(var c=0;a!=null&&c<a.length;c++){var b=a[c].replace(/\s/g,"&nbsp;");d=d.replace(a[c],b)}}return d}function fillBackTargetValue(){var b=$("#targetField_"+adressName).val();var a=$("#targetField_"+adressName).attr("delimiter")}function openMobileDialog(d,b,c){var a=$("#isMobile").val()=="true"?true:false;if(a){mobileDialogOpen.scrollTop=$("body").scrollTop();$("#aws-form-container").hide();var e=$("#isMainForm").val()=="true"?window:parent;e.$("#mainFormPage").hide();e.$("#boItemNameSearch_div").html("");if(d="address"){if($("#isMainForm").val()=="false"){if(c){c.isSelf=true}else{c={isSelf:true}}}mobileDialogOpen.openMobileAddress("","",b,"",c,false);boItemNameGlobal=undefined;configGlobal=undefined;addressDatasObj={}}}}var boItemNameGlobal;var configGlobal;var addressDatasObj={};var mobileDialogOpen={openMobileAddress:function(f,e,a,d,b,c){awsui.ajax.request({type:"POST",url:"../r/jd",dataType:"json",alert:false,data:{sid:$("#sid").val(),cmd:"CLIENT_UI_MOBILE_CHOOSE_TASK_PERSON",keyWord:f,dept:e,type:"address",haveChooseUser:"",addressConfig:awsui.encode(b),isShowUser:c,appId:$("#appId").length>0?$("#appId").val():"_bpm.portal"},ok:function(j){if(b!=undefined&&configGlobal==undefined){configGlobal=b}var i=$("#isMainForm").val()=="true"||(configGlobal&&configGlobal.isSelf)?window:parent;if(a&&!boItemNameGlobal){boItemNameGlobal=a}i.$("#mainFormPage").hide();i.$("#boItemNameSearch_div").html(j.data.html);i.$("#boItemNameSearch_div").show();mobileDialogOpen.initCheckBoxStatus();var l=i.document.getElementById("list");l.style.height=(i.$("#boItemNameSearch_div").height()-50)+"px";try{setTimeout(function(){if($(".mui-indexed-list-bar").length!==0){window.indexedList=new mui.IndexedList(l)}},500)}catch(m){}var g="click";try{if(!($.browser.isIPhone&&top.location.href!=location.href)){g="tap"}}catch(m){}var h=j.data.isDeptAddress;if(f!==""){if(h){}else{$("#listDiv .mui-address-dept-div:first,#listDiv #deptList").hide()}}else{if(h){}else{$("#listDiv .mui-address-dept-div:first,#listDiv #deptList").show()}}i.$("#chooseUserBack").off(g).on(g,function(n){setTimeout(function(){mobileDialogOpen.chooseUserBack()},12);n.preventDefault();n.stopPropagation()});i.$("#choosePersondone").off(g).on(g,function(n){setTimeout(function(){mobileDialogOpen.chooseDone()},12);n.preventDefault();n.stopPropagation()});i.$("#emptyAddress").off("click").on("click",function(n){mobileDialogOpen.emptyAddress();n.preventDefault();n.stopPropagation();return false});i.$("#searchPersonIcon").off(g).on(g,function(n){mobileDialogOpen.searchPerson()});var k=window.mui?window.mui:$;k("#userHeader").on("tap","#openteamdialog",function(){var q=configGlobal.addressSetting?configGlobal.addressSetting.choiceType:"multiple";var o=configGlobal.addressSetting?configGlobal.addressSetting.delimiter:",";var p=configGlobal.addressSetting?configGlobal.addressSetting.leafType:"user";var n={teamSetting:{choiceType:q,selimiter:o},addressSetting:{sourceFields:configGlobal.sourceField?configGlobal.sourceField:"UID",targetFields:configGlobal.targetField?configGlobal.targetField:a,leafType:p,addressDatasObj:addressDatasObj,delimiter:o}};mobileDialogOpen.openTeamDialog(a,n,"address",b)});i.$("#searchPerson").bind("keyup",function(n){if(n.which===13){i.$("#searchPerson").blur();mobileDialogOpen.searchPerson()}});i.$(window).off("resize.mobileAddress").on("resize.mobileAddress",function(){l.style.height=(i.$("#boItemNameSearch_div").height()-50)+"px"});i.mobileDialogOpen.bindAllEvent()},err:function(g){$.simpleAlert(g.msg,g.result)}})},bindAllEvent:function(){if($("#upParentDept")){$("#upParentDept").off("tap").on("tap",function(){mobileDialogOpen.upParentDept($(this).attr("value"),$(this).attr("companyId"))})}var a=$("#isMainForm").val()=="true"||(configGlobal&&configGlobal.isSelf)?window:parent;a.$("input[name^=chooseDept]").off("click").on("click",function(b){mobileDialogOpen.changeDeptAddressData(this);b.stopPropagation()});a.$("div[name=mui-address-dept-user-click]").each(function(){var b=$(this);b.off("click").on("click",function(){var d=b.attr("value");var c=b.attr("isShowUser");mobileDialogOpen.showDeptPerson(d,boItemNameGlobal,c)})});if($("#searchPerson").attr("placeholder")=="搜索部门"){$("#deptList").css("max-height","100%");$(".fullDeptName").css("max-width",$(".fullDeptName").parent().width()-100)}},openTeamDialog:function(a,c,d,e){var b="./w?sid="+$("#sid").val()+"&cmd=CLIENT_UI_TEAM_OPEN&config="+encodeURI(JSON.stringify(c))+"&boItemValue="+$("#"+a).val()+"&boItemName="+a+"&showval="+$("#"+a).val()+"&hidval="+$("#"+a).val()+"&isMobile=true";mobileTeamUi.openMobileTeamUi(a,b,c,d,e)},chooseDone:function(){var g={};var q="";if(configGlobal&&configGlobal.isAdvMode){var d=(configGlobal.deptSourceField||configGlobal.sourceField).split(",");var y=Object.keys(addressDatasObj);if(configGlobal.addressType=="dept"){y=configGlobal.deptTargetField.split(",")}for(var o=0;o<y.length;o++){var x=y[o];var s=addressDatasObj[x];var c="";var w=configGlobal.addressSetting.delimiter;if(s!=undefined&&s.length>0){if($("#"+x).parent().length>0&&$("#"+x).parent()[0].id.indexOf("awsui-address")>-1){var p=s.split(w);var f=$("#"+x).parent();f.find(".awsui-item").removeAttr("ischeck");var r=f.width()-52;var z="max-width:"+r+"px";if(d[o]=="DEPTID"||d[o]=="UID"){var n="";if(d[o]=="DEPTID"){n="<div class='awsui-item-icon awsui-iconfont'>&#59318;</div>"}else{if(d[o]=="UID"){n="<div class='awsui-item-icon awsui-iconfont'>&#58939;</div>"}}for(var k=0;k<p.length;k++){var u=p[k].split("%");var h=u[0];var l=u[0];l=u[0];if(u.length==2){h=u[1]}if(f.find('.awsui-item[value="'+l+'"]').length==0){var u="<div class='awsui-item' value='"+l+"' ischeck='true' name='"+h+"'>"+n+"<div class='awsui-item-t' style='"+z+"'>"+h+"</div><div class='awsui-item-del awsui-iconfont' onclick='deleteItem(this);return false;'>&#59134;</div></div>";f.append($(u))}else{f.find('.awsui-item[value="'+l+'"]').attr("ischeck","true")}c+=l+w}f.find(".awsui-item").each(function(){if($(this).attr("ischeck")==undefined){$(this).remove()}});if(c.length>0){c=c.substring(0,c.length-1)}$("#"+x).val(c)}else{var r=f.width()-35;var z="max-width:"+r+"px";f.find(".awsui-item").remove();for(var k=0;k<p.length;k++){var u=p[k];if(u!=""){var u="<div class='awsui-item' value='"+u+"' ischeck='true' name='"+u+"'><div class='awsui-item-t' style='"+z+"'>"+u+"</div><div class='awsui-item-del awsui-iconfont' onclick='deleteItem(this);return false;'>&#59134;</div></div>";f.append($(u))}}$("#"+x).val(s)}}else{var p=s.split(" ");for(var k=0;k<p.length;k++){var u=p[k].split("%");if(u!=""){c+=u[0]+w}}if(c.length>0){c=c.substring(0,c.length-1)}if(window.ui&&typeof(window.ui)=="function"){window.ui($.escapeSelector(x),c)}else{$("#"+x).val(c)}}$("#"+x).parent().find(".awsui-address-del").show()}else{if(x!=""){if($("#"+x).parent().length>0&&$("#"+x).parent()[0].id.indexOf("awsui-address")>-1){$("#"+x).parent().find(".awsui-item").remove()}$("#"+x).val("");$("#"+x).parent().find(".awsui-address-del").hide()}}q=addressDatasObj[boItemNameGlobal];g[x]=q;try{$("#"+x).trigger("blur.case"+x)}catch(t){}}}else{var f=$("#"+boItemNameGlobal).parent();var r=f.width()-52;var z="max-width:"+r+"px";f.find(".awsui-item").removeAttr("ischeck");for(var b in addressDatasObj[boItemNameGlobal]){var v=addressDatasObj[boItemNameGlobal][b].split("%");var j=v[0];var a=j;if(v.length==2){a=v[1]}if(q==""){q=j}else{q+=" "+j}if(f.find('.awsui-item[value="'+j+'"]').length==0){var u="<div class='awsui-item' value='"+j+"' ischeck='true' name='"+a+"'><div class='awsui-item-icon awsui-iconfont'>&#58939;</div><div class='awsui-item-t' style='"+z+"'>"+a+"</div><div class='awsui-item-del awsui-iconfont' onclick='deleteItem(this);return false;'>&#59134;</div></div>";f.append($(u))}else{f.find('.awsui-item[value="'+j+'"]').attr("ischeck","true")}}f.find(".awsui-item").each(function(){if($(this).attr("ischeck")==undefined){$(this).remove()}});if(f.find(".awsui-item").length>0){f.find(".awsui-address-del").show()}else{f.find(".awsui-address-del").hide()}$("#"+boItemNameGlobal).val(q);g[boItemNameGlobal]=q;try{$("#"+boItemNameGlobal).trigger("blur.case"+boItemNameGlobal)}catch(t){}}if(f!=null){if($("#"+boItemNameGlobal).val()==""){f.find("#awsui-placeholder-"+boItemNameGlobal).show()}else{f.find("#awsui-placeholder-"+boItemNameGlobal).hide()}}if(window.onAddressSelectedEvent){try{window.onAddressSelectedEvent(boItemNameGlobal,q,g)}catch(t){}}mobileDialogOpen.chooseUserBack()},emptyAddress:function(){if(configGlobal&&configGlobal.isAdvMode){var a=(configGlobal.targetField||configGlobal.deptTargetField).split(",");for(var b=0;b<a.length;b++){var c=a[b];$("#"+c).val("");$("#"+c).parent().find(".awsui-item").remove();$("#"+c).parent().find(".awsui-address-del").hide();try{$("#"+c).trigger("blur.case"+key)}catch(d){}}}else{$("#"+boItemNameGlobal).val("");$("#"+boItemNameGlobal).parent().find(".awsui-item").remove();$("#"+boItemNameGlobal).parent().find(".awsui-address-del").hide();try{$("#"+boItemNameGlobal).trigger("blur.case"+boItemNameGlobal)}catch(d){}}if(window.onAddressSelectedEvent){window.onAddressSelectedEvent(boItemNameGlobal,"",{})}mobileDialogOpen.chooseUserBack()},chooseUserBack:function(){if($("#isMainForm").val()=="false"){mobileChooseDivShow.close(true)}else{mobileChooseDivShow.close()}if(configGlobal&&configGlobal.isSelf){parent.mobileDialog.btnControl("enable")}$("#aws-form-container").show();$("body").scrollTop(mobileDialogOpen.scrollTop);mobileDialogOpen.scrollTop=0;try{if($("#isMobile").val()=="true"&&navigator.userAgent.toLowerCase().indexOf("iphone")>-1){$(".awsui-item-t,.awsui-item-del,.awsui-item-icon").css("top","0px")}}catch(a){}return false},searchPerson:function(){var a=$("#isMainForm").val()=="true"||(configGlobal&&configGlobal.isSelf)?window:parent;var b=a.$("#searchPerson").val();setTimeout(function(){mobileDialogOpen.openMobileAddress(b,"","","",configGlobal)},300)},showDeptPerson:function(c,a,b){mobileDialogOpen.openMobileAddress("",c,a,"",configGlobal,b)},upParentDept:function(b,a){awsui.ajax.request({url:"./jd",method:"POST",async:false,data:{sid:$("#sid").val(),cmd:"CLIENT_UI_MOBILE_PARENT_DEPT_USER_HTML",deptId:b,addressConfig:awsui.encode(configGlobal),appId:$("#appId").length>0?$("#appId").val():"_bpm.portal",companyId:a?a:""},success:function(c){$("#listDiv").children().remove();$("#listDiv").prepend(c.data.departmentHtml);$("#listDiv").append(c.data.userHtml);mobileDialogOpen.initCheckBoxStatus();mobileDialogOpen.bindAllEvent()}})},initCheckBoxStatus:function(){if(configGlobal&&configGlobal.isAdvMode){var f=configGlobal.targetField.split(",");if(f.length>0){for(var c=0;c<f.length;c++){var h=f[c];if(configGlobal.sourceField.indexOf("UID")>-1||configGlobal.sourceField.indexOf("USERNAMEALIAS")>-1){if(addressDatasObj[h]==undefined){addressDatasObj[h]=$("#"+h).val()}$('input[name="choosePersonCheck"]').each(function(){var i=-1;var k=configGlobal.sourceField.split(",");for(var l=0;l<k.length;l++){if(k[l]=="UID"||k[l]=="USERNAMEALIAS"){i=l}}var m;if(addressDatasObj[h]==undefined){if($.trim($("#"+f[i]).val())!=""){m=$("#"+f[i]).val().split(configGlobal.addressSetting.delimiter)}}else{if(addressDatasObj[h]!=""){m=addressDatasObj[h].split(configGlobal.addressSetting.delimiter)}}if(m){$('input[name="choosePersonCheck"]').each(function(){var n=$(this).val().split("$");for(var o=0;o<m.length;o++){var p;var q=m[o].split("%")[0];if(q.indexOf("<")>-1){p=q.substring(0,q.indexOf("<"))}else{p=q}if(p==n[0]){$(this).attr("checked",true);break}}})}else{addressDatasObj[h]=""}})}else{addressDatasObj[h]=""}}}else{var d=configGlobal.deptTargetField.split(",");if(d.length>0){for(var c=0;c<d.length;c++){var h=d[c]}}}}else{if(!addressDatasObj[boItemNameGlobal]){addressDatasObj[boItemNameGlobal]={};var e=$("#"+boItemNameGlobal).val();var g=e.split(" ");for(var c=0;c<g.length;c++){var b=g[c];if(b!=""){var a=b;if(b.indexOf("<")!=-1){a=b.substring(0,b.indexOf("<"))}addressDatasObj[boItemNameGlobal][a]=b;$('input[name="choosePersonCheck"]').each(function(){var i=$(this).val().split(",");if(a==i[0]){$(this).attr("checked",true);return false}})}}}else{for(var a in addressDatasObj[boItemNameGlobal]){$('input[name="choosePersonCheck"]').each(function(){var i=$(this).val().split(",");if(a==i[0]){$(this).attr("checked",true);return false}})}}}},changeAddressData:function(g){var p=$(g).find("input[name=choosePersonCheck]:first");if($(g).attr("addressType")=="task"){if(p.is(":checked")){if(p.hasClass("mui-address-radio")){$("#dialog_toolbar_extend_btn_action_page_frame_mobile")[0].contentWindow.chooseDone()}}}else{if(configGlobal&&configGlobal.isAdvMode){var o=p.val().split("$");var n=awsui.decode(o[4]);if(p.is(":checked")){var e=configGlobal.targetField.split(",");var l=configGlobal.sourceField.split(",");for(var h=0;h<e.length;h++){var d=e[h];var k=$("#targetField_"+d).attr("delimiter")||" ";var a=n[h][Object.keys(n[h])[0]];if(l[h]=="UID"){a=a+"%"+o[1]}if(addressDatasObj[d]==""){addressDatasObj[d]=a}else{if($(g).hasClass("mui-radio")){addressDatasObj[d]=a}else{addressDatasObj[d]+=k+a}}}}else{var e=configGlobal.targetField.split(",");for(var h=0;h<e.length;h++){var d=e[h];var k=$("#targetField_"+d).attr("delimiter")||" ";var f=addressDatasObj[d].split(k);for(var c=0;c<f.length;c++){var b=f[c].split("%")[0];if(b==n[h][Object.keys(n[h])[0]]){f.splice(c,1);break}}addressDatasObj[d]=f.join(k)}}if(configGlobal.sourceField.indexOf("UID")>-1||configGlobal.sourceField.indexOf("USERNAMEALIAS")>-1){}}else{if(boItemNameGlobal){var o=p.val().split(",");if(p.val().indexOf("$")>-1){o=p.val().split("$")}if(p.is(":checked")){if(p.hasClass("mui-address-radio")){addressDatasObj[boItemNameGlobal]={}}addressDatasObj[boItemNameGlobal][o[0]]=o[3]+"%"+o[1]}else{for(var m in addressDatasObj[boItemNameGlobal]){if(m==o[0]){delete addressDatasObj[boItemNameGlobal][m];break}}}}}if($(g).hasClass("mui-radio")){setTimeout(function(){mobileDialogOpen.chooseDone()},12)}}},changeDeptAddressData:function(k){var g=(configGlobal.deptTargetField||configGlobal.targetField).split(",");var o=(configGlobal.deptSourceField||configGlobal.sourceField).split(",");var c=awsui.decode("["+$(k).attr("value")+"]");if($(k).is(":checked")){for(var m=0;m<g.length;m++){var f=g[m];var n=$("#targetField_"+f).attr("delimiter")||" ";var l=c[m][Object.keys(c[m])[0]];var a=$.trim($(k).next()[0].innerText);if(o[m]=="DEPTID"){l=l+"%"+a}if(!addressDatasObj[f]){addressDatasObj[f]=l}else{if($(k).attr("type")=="radio"){addressDatasObj[f]=l}else{addressDatasObj[f]+=n+l}}}}else{for(var m=0;m<g.length;m++){var f=g[m];var n=$("#targetField_"+f).attr("delimiter")||" ";try{var h=addressDatasObj[f].split(n);for(var d=0;d<h.length;d++){var b=h[d].split("%")[0];if(b==c[m][Object.keys(c[m])[0]]){h.splice(d,1);break}}addressDatasObj[f]=h.join(" ")}catch(p){}}}if($(k).attr("type")=="radio"){setTimeout(function(){mobileDialogOpen.chooseDone()},12)}}};